# 비동기



일반적인 자바스크립트 코드는 동기적으로 작동하지만 특수한 문법을 쓰면 코드를 비동기 동작으로 만들 수 있다.

이를 지원하는 것이 콜백, 프로미스, async await 이다.



## 콜백

```js
function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;

  script.onload = () => callback(script);

  document.head.append(script);
}
```

```js
loadScript('/my/script.js', function() {
  // 콜백 함수는 스크립트 로드가 끝나면 실행됩니다.
  newFunction(); // 이제 함수 호출이 제대로 동작합니다.
  ...
});
```



하지만 콜백방식은 흔히 콜백 지옥이라 불리는 코드 가독성이 안좋아질 수 있어서 콜백을 비동기로 활용하는 것은 추천하지 않는다.



## 프라미스

ES6에서는 비동기 처리를 위한 또 다른 패턴으로 프로미스(Promise)를 도입했다. 프로미스는 전통적인 콜백 패턴이 가진 단점을 보완하며 비동기 처리 시점을 명확하게 표현할 수 있다는 장점이 있다.



| 상태          | 의미                                       | 구현                                               |
| :------------ | :----------------------------------------- | :------------------------------------------------- |
| pending       | 비동기 처리가 아직 수행되지 않은 상태      | resolve 또는 reject 함수가 아직 호출되지 않은 상태 |
| **fulfilled** | 비동기 처리가 수행된 상태 (성공)           | resolve 함수가 호출된 상태                         |
| **rejected**  | 비동기 처리가 수행된 상태 (실패)           | reject 함수가 호출된 상태                          |
| settled       | 비동기 처리가 수행된 상태 (성공 또는 실패) | resolve 또는 reject 함수가 호출된 상태             |



프로미스 api

1. `Promise.all(promises)` – 모든 프라미스가 이행될 때까지 기다렸다가 그 결괏값을 담은 배열을 반환한다. 주어진 프라미스 중 하나라도 실패하면 `Promise.all`는 거부되고, 나머지 프라미스의 결과는 무시된다.
2. Promise.allSettled(promises) – 최근에 추가된 메서드로 모든 프라미스가 처리될 때까지 기다렸다가 그 결과(객체)를 담은 배열을 반환한다. 객체엔 다음과 같은 정보가 담긴다.
   - `status`: `"fulfilled"` 또는 `"rejected"`
   - `value`(프라미스가 성공한 경우) 또는 `reason`(프라미스가 실패한 경우)
3. `Promise.race(promises)` – 가장 먼저 처리된 프라미스의 결과 또는 에러를 담은 프라미스를 반환한다.
4. `Promise.resolve(value)` – 주어진 값을 사용해 이행 상태의 프라미스를 만든다.
5. `Promise.reject(error)` – 주어진 에러를 사용해 거부 상태의 프라미스를 만든다.



## async await

제너레이터가 진화한 es7에 async await가 등장하게 되었다.



```js
const fetch = require('node-fetch');

// Promise를 반환하는 함수 정의
function getUser(username) {
  return fetch(`https://api.github.com/users/${username}`)
    .then(res => res.json())
    .then(user => user.name);
}

async function getUserAll() {
  let user;
  user = await getUser('jeresig');
  console.log(user);

  user = await getUser('ahejlsberg');
  console.log(user);

  user = await getUser('ungmo2');
  console.log(user);
}

getUserAll();
```

다음과 같이 async await 를 활용할 수 있다.